{"ast":null,"code":"var _jsxFileName = \"/Users/ttc/Desktop/QLDA_QLKS_django_react/react-website/src/components/booking/PaymentResult.js\";\nimport React, { useEffect, useState } from 'react';\nimport { useLocation } from 'react-router-dom';\nimport { api } from '../utils/ApiFunctions'; // Đảm bảo bạn có sẵn phương thức này\nimport Cookies from 'react-cookies';\nconst PaymentResult = () => {\n  const location = useLocation();\n  const [paymentResult, setPaymentResult] = useState(null);\n  const csrftoken = Cookies.load('csrftoken');\n  const updateBookingStatus = async (bookingId, status) => {\n    try {\n      await api.post(`/hotel/booking/${bookingId}/change-status/`, {\n        payment_status: status\n      }, {\n        headers: {\n          'Content-Type': 'application/json',\n          'X-CSRFToken': csrftoken\n        }\n      });\n    } catch (error) {\n      console.error('Error updating booking status:', error);\n    }\n  };\n  const updateVnpResponseCode = async (bookingId, vnpResponseCode) => {\n    try {\n      await api.patch(`/hotel/invoices/update_vnp_response_code_by_booking/`, {\n        booking_id: bookingId,\n        vnp_response_code: vnpResponseCode,\n        status: \"paid\"\n      }, {\n        headers: {\n          'Content-Type': 'application/json',\n          'X-CSRFToken': csrftoken\n        }\n      });\n    } catch (error) {\n      console.error('Error updating VNPay response code:', error);\n    }\n  };\n  useEffect(() => {\n    const queryParams = new URLSearchParams(location.search);\n    const result = queryParams.get('vnp_TransactionStatus');\n    if (result) {\n      const isSuccess = result === '00';\n      setPaymentResult({\n        title: result === '00' ? \"Payment Success\" : \"Payment Failure\",\n        result: result === '00' ? \"Success\" : \"Failed\",\n        orderId: queryParams.get('vnp_TxnRef'),\n        amount: queryParams.get('vnp_Amount'),\n        orderDesc: queryParams.get('vnp_OrderInfo'),\n        vnpTransactionNo: queryParams.get('vnp_TransactionNo'),\n        vnpResponseCode: queryParams.get('vnp_ResponseCode'),\n        msg: queryParams.get('vnp_Message') || \"No message provided\"\n      });\n      const bookingId = localStorage.getItem('bookingId');\n      if (isSuccess && bookingId) {\n        updateBookingStatus(bookingId, 'paid');\n        updateVnpResponseCode(bookingId, queryParams.get('vnp_ResponseCode'));\n        // Sau khi cập nhật trạng thái thành công, có thể xóa `bookingId` khỏi localStorage\n        localStorage.removeItem('bookingId');\n        localStorage.removeItem('bookingConfirmationCode');\n      }\n    }\n  }, [location.search]);\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"payment-result-container\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 75,\n      columnNumber: 9\n    }\n  }, paymentResult ? /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 77,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(\"h3\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 78,\n      columnNumber: 21\n    }\n  }, paymentResult.title), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"payment-result-details\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 79,\n      columnNumber: 21\n    }\n  }, /*#__PURE__*/React.createElement(\"p\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 80,\n      columnNumber: 25\n    }\n  }, /*#__PURE__*/React.createElement(\"strong\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 80,\n      columnNumber: 28\n    }\n  }, \"Transaction Result:\"), \" \", paymentResult.result), /*#__PURE__*/React.createElement(\"p\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 81,\n      columnNumber: 25\n    }\n  }, /*#__PURE__*/React.createElement(\"strong\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 81,\n      columnNumber: 28\n    }\n  }, \"Order ID:\"), \" \", paymentResult.orderId), /*#__PURE__*/React.createElement(\"p\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 82,\n      columnNumber: 25\n    }\n  }, /*#__PURE__*/React.createElement(\"strong\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 82,\n      columnNumber: 28\n    }\n  }, \"Amount:\"), \" \", paymentResult.amount, \" VND\"), /*#__PURE__*/React.createElement(\"p\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 83,\n      columnNumber: 25\n    }\n  }, /*#__PURE__*/React.createElement(\"strong\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 83,\n      columnNumber: 28\n    }\n  }, \"Order Description:\"), \" \", paymentResult.orderDesc), /*#__PURE__*/React.createElement(\"p\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 84,\n      columnNumber: 25\n    }\n  }, /*#__PURE__*/React.createElement(\"strong\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 84,\n      columnNumber: 28\n    }\n  }, \"VNPay Transaction No:\"), \" \", paymentResult.vnpTransactionNo), /*#__PURE__*/React.createElement(\"p\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 85,\n      columnNumber: 25\n    }\n  }, /*#__PURE__*/React.createElement(\"strong\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 85,\n      columnNumber: 28\n    }\n  }, \"VNPay Response Code:\"), \" \", paymentResult.vnpResponseCode), /*#__PURE__*/React.createElement(\"p\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 86,\n      columnNumber: 25\n    }\n  }, /*#__PURE__*/React.createElement(\"strong\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 86,\n      columnNumber: 28\n    }\n  }, \"Message:\"), \" \", paymentResult.msg))) : /*#__PURE__*/React.createElement(\"p\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 90,\n      columnNumber: 17\n    }\n  }, \"Loading payment result...\"));\n};\nexport default PaymentResult;","map":{"version":3,"names":["React","useEffect","useState","useLocation","api","Cookies","PaymentResult","location","paymentResult","setPaymentResult","csrftoken","load","updateBookingStatus","bookingId","status","post","payment_status","headers","error","console","updateVnpResponseCode","vnpResponseCode","patch","booking_id","vnp_response_code","queryParams","URLSearchParams","search","result","get","isSuccess","title","orderId","amount","orderDesc","vnpTransactionNo","msg","localStorage","getItem","removeItem","createElement","className","__self","__source","fileName","_jsxFileName","lineNumber","columnNumber"],"sources":["/Users/ttc/Desktop/QLDA_QLKS_django_react/react-website/src/components/booking/PaymentResult.js"],"sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { useLocation } from 'react-router-dom';\nimport { api } from '../utils/ApiFunctions'; // Đảm bảo bạn có sẵn phương thức này\nimport Cookies from 'react-cookies';\n\nconst PaymentResult = () => {\n    const location = useLocation();\n\n    const [paymentResult, setPaymentResult] = useState(null);\n    const csrftoken = Cookies.load('csrftoken');\n\n\n    const updateBookingStatus = async (bookingId, status) => {\n        try {\n            await api.post(`/hotel/booking/${bookingId}/change-status/`, {\n                payment_status: status\n            }, {\n                headers: {\n                    'Content-Type': 'application/json',\n                    'X-CSRFToken': csrftoken\n                }\n            });\n        } catch (error) {\n            console.error('Error updating booking status:', error);\n        }\n    };\n\n    const updateVnpResponseCode = async (bookingId, vnpResponseCode) => {\n        try {\n            await api.patch(`/hotel/invoices/update_vnp_response_code_by_booking/`, {\n                booking_id: bookingId,\n                vnp_response_code: vnpResponseCode,\n                status: \"paid\"\n            }, {\n                headers: {\n                    'Content-Type': 'application/json',\n                    'X-CSRFToken': csrftoken\n                }\n            });\n        } catch (error) {\n            console.error('Error updating VNPay response code:', error);\n        }\n    };\n\n    useEffect(() => {\n        const queryParams = new URLSearchParams(location.search);\n        \n        const result = queryParams.get('vnp_TransactionStatus');\n\n        if (result) {\n            const isSuccess = result === '00';\n            setPaymentResult({\n                title: result === '00' ? \"Payment Success\" : \"Payment Failure\",\n                result: result === '00' ? \"Success\" : \"Failed\",\n                orderId: queryParams.get('vnp_TxnRef'),\n                amount: queryParams.get('vnp_Amount'),\n                orderDesc: queryParams.get('vnp_OrderInfo'),\n                vnpTransactionNo: queryParams.get('vnp_TransactionNo'),\n                vnpResponseCode: queryParams.get('vnp_ResponseCode'),\n                msg: queryParams.get('vnp_Message') || \"No message provided\"\n            });\n\n            const bookingId = localStorage.getItem('bookingId');\n            if (isSuccess && bookingId) {\n                updateBookingStatus(bookingId, 'paid');\n                updateVnpResponseCode(bookingId, queryParams.get('vnp_ResponseCode'));\n                // Sau khi cập nhật trạng thái thành công, có thể xóa `bookingId` khỏi localStorage\n                localStorage.removeItem('bookingId');\n                localStorage.removeItem('bookingConfirmationCode');\n            }\n        }\n    }, [location.search]);\n\n    return (\n        <div className=\"payment-result-container\">\n            {paymentResult ? (\n                <div>\n                    <h3>{paymentResult.title}</h3>\n                    <div className=\"payment-result-details\">\n                        <p><strong>Transaction Result:</strong> {paymentResult.result}</p>\n                        <p><strong>Order ID:</strong> {paymentResult.orderId}</p>\n                        <p><strong>Amount:</strong> {paymentResult.amount} VND</p>\n                        <p><strong>Order Description:</strong> {paymentResult.orderDesc}</p>\n                        <p><strong>VNPay Transaction No:</strong> {paymentResult.vnpTransactionNo}</p>\n                        <p><strong>VNPay Response Code:</strong> {paymentResult.vnpResponseCode}</p>\n                        <p><strong>Message:</strong> {paymentResult.msg}</p>\n                    </div>\n                </div>\n            ) : (\n                <p>Loading payment result...</p>\n            )}\n        </div>\n    );\n};\n\nexport default PaymentResult;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}